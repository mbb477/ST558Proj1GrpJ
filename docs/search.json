[
  {
    "objectID": "ST558Proj1.html",
    "href": "ST558Proj1.html",
    "title": "ST558 Project 1",
    "section": "",
    "text": "One of the goals of this project is to create a function that can take in a URL and process and parse similar types of data sets in a specific way. The data sets we are working with are files that contain Census Bureau information.\n\n\nWe will start with the EDU01a data set and use it to outline the steps that will be necessary to create our wrapper function. To begin, the appropriate packages are loaded and the data imported using read_csv. This function is appropriate for csv files. The data already contains column names, which is the default for this function, so it is not necessary to specify an argument regarding column names.\n\nlibrary(tidyverse)\nlibrary(readr)\ncensus_1a_original &lt;- \nread_csv(\"https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv\")\n\nRows: 3198 Columns: 42\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (22): Area_name, STCOU, EDU010187N1, EDU010187N2, EDU010188N1, EDU010188...\ndbl (20): EDU010187F, EDU010187D, EDU010188F, EDU010188D, EDU010189F, EDU010...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nhead(census_1a_original)\n\n# A tibble: 6 × 42\n  Area_name     STCOU EDU010187F EDU010187D EDU010187N1 EDU010187N2 EDU010188F\n  &lt;chr&gt;         &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;dbl&gt;\n1 UNITED STATES 00000          0   40024299 0000        0000                 0\n2 ALABAMA       01000          0     733735 0000        0000                 0\n3 Autauga, AL   01001          0       6829 0000        0000                 0\n4 Baldwin, AL   01003          0      16417 0000        0000                 0\n5 Barbour, AL   01005          0       5071 0000        0000                 0\n6 Bibb, AL      01007          0       3557 0000        0000                 0\n# ℹ 35 more variables: EDU010188D &lt;dbl&gt;, EDU010188N1 &lt;chr&gt;, EDU010188N2 &lt;chr&gt;,\n#   EDU010189F &lt;dbl&gt;, EDU010189D &lt;dbl&gt;, EDU010189N1 &lt;chr&gt;, EDU010189N2 &lt;chr&gt;,\n#   EDU010190F &lt;dbl&gt;, EDU010190D &lt;dbl&gt;, EDU010190N1 &lt;chr&gt;, EDU010190N2 &lt;chr&gt;,\n#   EDU010191F &lt;dbl&gt;, EDU010191D &lt;dbl&gt;, EDU010191N1 &lt;chr&gt;, EDU010191N2 &lt;chr&gt;,\n#   EDU010192F &lt;dbl&gt;, EDU010192D &lt;dbl&gt;, EDU010192N1 &lt;chr&gt;, EDU010192N2 &lt;chr&gt;,\n#   EDU010193F &lt;dbl&gt;, EDU010193D &lt;dbl&gt;, EDU010193N1 &lt;chr&gt;, EDU010193N2 &lt;chr&gt;,\n#   EDU010194F &lt;dbl&gt;, EDU010194D &lt;dbl&gt;, EDU010194N1 &lt;chr&gt;, EDU010194N2 &lt;chr&gt;, …\n\n\n\n\n\nThe next step is to select the columns we are interested in, followed by pivoting the data into a long format, which is more appropriate for data analysis. In this case, we are selecting Area_name, which is also being renamed to area_name, STCOU, which is a state (first 2 digits) and county (last 3 digits) code and all columns that end with a “D”. These columns ending in “D” correspond to an id that identifies the type of survey and value associated with it and the 2 digit year.\n\ncensus_1a_condensed &lt;- census_1a_original |&gt;\n  select(Area_name, STCOU, ends_with(\"D\")) |&gt;\n  rename(area_name = Area_name) |&gt;\n  pivot_longer(cols = 3:12, \n               names_to = \"item_id\", \n               values_to = \"enrollment\") |&gt; \n  filter(area_name != \"District of Columbia\")\nhead(census_1a_condensed) \n\n# A tibble: 6 × 4\n  area_name     STCOU item_id    enrollment\n  &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt;\n1 UNITED STATES 00000 EDU010187D   40024299\n2 UNITED STATES 00000 EDU010188D   39967624\n3 UNITED STATES 00000 EDU010189D   40317775\n4 UNITED STATES 00000 EDU010190D   40737600\n5 UNITED STATES 00000 EDU010191D   41385442\n6 UNITED STATES 00000 EDU010192D   42088151\n\n\n\n\n\nNext, we want to pull out the year from the item_id and convert it to an appropriate, 4-digit form placed in it’s own column. We also want to isolate and put in it’s own column the portion of the item_id that corresponds to the survey code and value associated with it. We can use the mutate function to add these columns. The substr() function allows you to extract a string based on position. For the year, for example, the numbers corresponding to the year are in the 8th and 9th position of the 10 character string. Then we add 1900 to the extracted 2 digit number to obtain the 4 digit year. The survey code is extracted in a similar manner.\n\ncensus_1a_add &lt;- census_1a_condensed |&gt;\n  mutate(year = (as.numeric(substr(item_id, 8, 9)) + 1900),\n         survey_code = substr(item_id, 1, 7))\ncensus_1a_add\n\n# A tibble: 31,970 × 6\n   area_name     STCOU item_id    enrollment  year survey_code\n   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      \n 1 UNITED STATES 00000 EDU010187D   40024299  1987 EDU0101    \n 2 UNITED STATES 00000 EDU010188D   39967624  1988 EDU0101    \n 3 UNITED STATES 00000 EDU010189D   40317775  1989 EDU0101    \n 4 UNITED STATES 00000 EDU010190D   40737600  1990 EDU0101    \n 5 UNITED STATES 00000 EDU010191D   41385442  1991 EDU0101    \n 6 UNITED STATES 00000 EDU010192D   42088151  1992 EDU0101    \n 7 UNITED STATES 00000 EDU010193D   42724710  1993 EDU0101    \n 8 UNITED STATES 00000 EDU010194D   43369917  1994 EDU0101    \n 9 UNITED STATES 00000 EDU010195D   43993459  1995 EDU0101    \n10 UNITED STATES 00000 EDU010196D   44715737  1996 EDU0101    \n# ℹ 31,960 more rows\n\n\n\n\n\nIn this next step, we separate the observations into two data sets based on the presence or absence of a character string pattern in the area_name variable. Specifically, we use the grepl() function to identify observations within the area_name column that contain the pattern of a comma followed by a space and then two consecutive characters, which is indicative of county level data. First, we use the filter() function to select only those rows that contain the pattern and store these in the county_data tibble. then we use filter() to select only those rows that do NOT contain the pattern, and store those in the noncounty_data tibble. From here, we also assign a “county” or “non-county” class to each new data set.\n\ncounty_data &lt;- census_1a_add |&gt;\n  filter(grepl(pattern = \", \\\\w\\\\w\", area_name))\n\nnoncounty_data &lt;- census_1a_add |&gt;\n  filter(!grepl(pattern = \", \\\\w\\\\w\", area_name))\n\nclass(county_data) &lt;- c(\"county\", class(county_data))\nclass(noncounty_data) &lt;- c(\"state\", class(noncounty_data))\n\nhead(county_data)\n\n# A tibble: 6 × 6\n  area_name   STCOU item_id    enrollment  year survey_code\n  &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      \n1 Autauga, AL 01001 EDU010187D       6829  1987 EDU0101    \n2 Autauga, AL 01001 EDU010188D       6900  1988 EDU0101    \n3 Autauga, AL 01001 EDU010189D       6920  1989 EDU0101    \n4 Autauga, AL 01001 EDU010190D       6847  1990 EDU0101    \n5 Autauga, AL 01001 EDU010191D       7008  1991 EDU0101    \n6 Autauga, AL 01001 EDU010192D       7137  1992 EDU0101    \n\nhead(noncounty_data)\n\n# A tibble: 6 × 6\n  area_name     STCOU item_id    enrollment  year survey_code\n  &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      \n1 UNITED STATES 00000 EDU010187D   40024299  1987 EDU0101    \n2 UNITED STATES 00000 EDU010188D   39967624  1988 EDU0101    \n3 UNITED STATES 00000 EDU010189D   40317775  1989 EDU0101    \n4 UNITED STATES 00000 EDU010190D   40737600  1990 EDU0101    \n5 UNITED STATES 00000 EDU010191D   41385442  1991 EDU0101    \n6 UNITED STATES 00000 EDU010192D   42088151  1992 EDU0101    \n\n\n\n\n\nWithin the county data set, we now return to using substr() to extract the last two characters of the area_name variable, which indicates the two-letter abbreviation for which state in which the county is located. We store this in a new “state” variable.\n\ncounty_data &lt;- county_data |&gt;\n  mutate(state = substr(area_name, nchar(area_name)-1,\n                        nchar(area_name)))\ncounty_data\n\n# A tibble: 31,450 × 7\n   area_name   STCOU item_id    enrollment  year survey_code state\n   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;\n 1 Autauga, AL 01001 EDU010187D       6829  1987 EDU0101     AL   \n 2 Autauga, AL 01001 EDU010188D       6900  1988 EDU0101     AL   \n 3 Autauga, AL 01001 EDU010189D       6920  1989 EDU0101     AL   \n 4 Autauga, AL 01001 EDU010190D       6847  1990 EDU0101     AL   \n 5 Autauga, AL 01001 EDU010191D       7008  1991 EDU0101     AL   \n 6 Autauga, AL 01001 EDU010192D       7137  1992 EDU0101     AL   \n 7 Autauga, AL 01001 EDU010193D       7152  1993 EDU0101     AL   \n 8 Autauga, AL 01001 EDU010194D       7381  1994 EDU0101     AL   \n 9 Autauga, AL 01001 EDU010195D       7568  1995 EDU0101     AL   \n10 Autauga, AL 01001 EDU010196D       7834  1996 EDU0101     AL   \n# ℹ 31,440 more rows\n\n\n\n\n\nFor the non-county data set, we use a series of “ifelse” statements to indicate the set of states belonging to each U.S. division, creating a new “division” variable to store this information. When the area in question is not a state (e.g., UNITED STATES), this will return “ERROR”.\n\nnoncounty_data &lt;- noncounty_data |&gt;\n  mutate(division = ifelse(area_name %in% c(\n    \"CONNECTICUT\", \"MAINE\", \"MASSACHUSETTS\", \"NEW HAMPSHIRE\", \n    \"RHODE ISLAND\", \"VERMONT\"), \"New England\",\n    ifelse(area_name %in% c(\n      \"NEW JERSEY\", \"NEW YORK\", \"PENNSYLVANIA\"), \n      \"Middle Atlantic\", \n      ifelse(area_name %in% c(\n        \"ILLINOIS\", \"INDIANA\", \"MICHIGAN\", \"OHIO\", \"WISCONSIN\"),\n        \"East North Central\", \n        ifelse(area_name %in% c(\n          \"IOWA\", \"KANSAS\", \"MINNESOTA\", \"MISSOURI\", \"NEBRASKA\",\n          \"NORTH DAKOTA\", \"SOUTH DAKOTA\"), \"West North Central\",\n          ifelse(area_name %in% c(\n            \"DELAWARE\", \"FLORIDA\", \"GEORGIA\", \"MARYLAND\", \n            \"NORTH CAROLINA\", \"SOUTH CAROLINA\", \"VIRGINIA\",\n            \"DISTRICT OF COLUMBIA\", \"WEST VIRGINIA\"), \n            \"South Atlantic\",\n            ifelse(area_name %in% c(\n              \"ALABAMA\", \"KENTUCKY\", \"MISSISSIPPI\", \"TENNESSEE\"),\n              \"East South Central\",\n              ifelse(area_name %in% c(\n                \"ARKANSAS\", \"LOUISIANA\", \"OKLAHOMA\", \"TEXAS\"),\n                \"West South Central\",\n                ifelse(area_name %in% c(\n                  \"ARIZONA\", \"COLORADO\", \"IDAHO\", \"MONTANA\",\n                  \"NEVADA\", \"NEW MEXICO\", \"UTAH\", \"WYOMING\"),\n                  \"Mountain\",\n                  ifelse(area_name %in% c(\n                    \"ALASKA\", \"CALIFORNIA\", \"HAWAII\", \"OREGON\",\n                    \"WASHINGTON\"), \"Pacific\", \n                  \"ERROR\"))))))))))\nnoncounty_data\n\n# A tibble: 520 × 7\n   area_name     STCOU item_id    enrollment  year survey_code division\n   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;   \n 1 UNITED STATES 00000 EDU010187D   40024299  1987 EDU0101     ERROR   \n 2 UNITED STATES 00000 EDU010188D   39967624  1988 EDU0101     ERROR   \n 3 UNITED STATES 00000 EDU010189D   40317775  1989 EDU0101     ERROR   \n 4 UNITED STATES 00000 EDU010190D   40737600  1990 EDU0101     ERROR   \n 5 UNITED STATES 00000 EDU010191D   41385442  1991 EDU0101     ERROR   \n 6 UNITED STATES 00000 EDU010192D   42088151  1992 EDU0101     ERROR   \n 7 UNITED STATES 00000 EDU010193D   42724710  1993 EDU0101     ERROR   \n 8 UNITED STATES 00000 EDU010194D   43369917  1994 EDU0101     ERROR   \n 9 UNITED STATES 00000 EDU010195D   43993459  1995 EDU0101     ERROR   \n10 UNITED STATES 00000 EDU010196D   44715737  1996 EDU0101     ERROR   \n# ℹ 510 more rows"
  },
  {
    "objectID": "ST558Proj1.html#use-wrapper-function-on-our-first-data-set",
    "href": "ST558Proj1.html#use-wrapper-function-on-our-first-data-set",
    "title": "ST558 Project 1",
    "section": "Use wrapper function on our first data set",
    "text": "Use wrapper function on our first data set\n\ncensus_df_list_EDU01a &lt;- data_processing_wrapper(\"https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv\")\n\nRows: 3198 Columns: 42\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (22): Area_name, STCOU, EDU010187N1, EDU010187N2, EDU010188N1, EDU010188...\ndbl (20): EDU010187F, EDU010187D, EDU010188F, EDU010188D, EDU010189F, EDU010...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\ncensus_df_list_EDU01a\n\n$county_data\n# A tibble: 31,450 × 7\n   area_name   STCOU item_id    enrollment  year survey_code state\n   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;\n 1 Autauga, AL 01001 EDU010187D       6829  1987 EDU0101     AL   \n 2 Autauga, AL 01001 EDU010188D       6900  1988 EDU0101     AL   \n 3 Autauga, AL 01001 EDU010189D       6920  1989 EDU0101     AL   \n 4 Autauga, AL 01001 EDU010190D       6847  1990 EDU0101     AL   \n 5 Autauga, AL 01001 EDU010191D       7008  1991 EDU0101     AL   \n 6 Autauga, AL 01001 EDU010192D       7137  1992 EDU0101     AL   \n 7 Autauga, AL 01001 EDU010193D       7152  1993 EDU0101     AL   \n 8 Autauga, AL 01001 EDU010194D       7381  1994 EDU0101     AL   \n 9 Autauga, AL 01001 EDU010195D       7568  1995 EDU0101     AL   \n10 Autauga, AL 01001 EDU010196D       7834  1996 EDU0101     AL   \n# ℹ 31,440 more rows\n\n$noncounty_data\n# A tibble: 530 × 7\n   area_name     STCOU item_id    enrollment  year survey_code division\n   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;   \n 1 UNITED STATES 00000 EDU010187D   40024299  1987 EDU0101     ERROR   \n 2 UNITED STATES 00000 EDU010188D   39967624  1988 EDU0101     ERROR   \n 3 UNITED STATES 00000 EDU010189D   40317775  1989 EDU0101     ERROR   \n 4 UNITED STATES 00000 EDU010190D   40737600  1990 EDU0101     ERROR   \n 5 UNITED STATES 00000 EDU010191D   41385442  1991 EDU0101     ERROR   \n 6 UNITED STATES 00000 EDU010192D   42088151  1992 EDU0101     ERROR   \n 7 UNITED STATES 00000 EDU010193D   42724710  1993 EDU0101     ERROR   \n 8 UNITED STATES 00000 EDU010194D   43369917  1994 EDU0101     ERROR   \n 9 UNITED STATES 00000 EDU010195D   43993459  1995 EDU0101     ERROR   \n10 UNITED STATES 00000 EDU010196D   44715737  1996 EDU0101     ERROR   \n# ℹ 520 more rows"
  },
  {
    "objectID": "ST558Proj1.html#short-function-that-takes-in-the-results-of-two-calls-of-the-wrapper-function-and-combines-the-county-level-and-non-county-level",
    "href": "ST558Proj1.html#short-function-that-takes-in-the-results-of-two-calls-of-the-wrapper-function-and-combines-the-county-level-and-non-county-level",
    "title": "ST558 Project 1",
    "section": "Short function that takes in the results of two calls of the wrapper function and combines the county level and non county level",
    "text": "Short function that takes in the results of two calls of the wrapper function and combines the county level and non county level\n\ncombine_census_lists &lt;- function(list1, list2) {\n  county_bind_result &lt;- bind_rows(list1$county_data, list2$county_data) \n  noncounty_bind_result &lt;- bind_rows(list1$noncounty_data, list2$noncounty_data) \n  return(list(county_bind_result, noncounty_bind_result))\n}\ncombined_census_lists_EDU &lt;- combine_census_lists(census_df_list_EDU01a, census_df_list_EDU01b)\ncombined_census_lists_EDU\n\n[[1]]\n# A tibble: 62,900 × 7\n   area_name   STCOU item_id    enrollment  year survey_code state\n   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;\n 1 Autauga, AL 01001 EDU010187D       6829  1987 EDU0101     AL   \n 2 Autauga, AL 01001 EDU010188D       6900  1988 EDU0101     AL   \n 3 Autauga, AL 01001 EDU010189D       6920  1989 EDU0101     AL   \n 4 Autauga, AL 01001 EDU010190D       6847  1990 EDU0101     AL   \n 5 Autauga, AL 01001 EDU010191D       7008  1991 EDU0101     AL   \n 6 Autauga, AL 01001 EDU010192D       7137  1992 EDU0101     AL   \n 7 Autauga, AL 01001 EDU010193D       7152  1993 EDU0101     AL   \n 8 Autauga, AL 01001 EDU010194D       7381  1994 EDU0101     AL   \n 9 Autauga, AL 01001 EDU010195D       7568  1995 EDU0101     AL   \n10 Autauga, AL 01001 EDU010196D       7834  1996 EDU0101     AL   \n# ℹ 62,890 more rows\n\n[[2]]\n# A tibble: 1,060 × 7\n   area_name     STCOU item_id    enrollment  year survey_code division\n   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;   \n 1 UNITED STATES 00000 EDU010187D   40024299  1987 EDU0101     ERROR   \n 2 UNITED STATES 00000 EDU010188D   39967624  1988 EDU0101     ERROR   \n 3 UNITED STATES 00000 EDU010189D   40317775  1989 EDU0101     ERROR   \n 4 UNITED STATES 00000 EDU010190D   40737600  1990 EDU0101     ERROR   \n 5 UNITED STATES 00000 EDU010191D   41385442  1991 EDU0101     ERROR   \n 6 UNITED STATES 00000 EDU010192D   42088151  1992 EDU0101     ERROR   \n 7 UNITED STATES 00000 EDU010193D   42724710  1993 EDU0101     ERROR   \n 8 UNITED STATES 00000 EDU010194D   43369917  1994 EDU0101     ERROR   \n 9 UNITED STATES 00000 EDU010195D   43993459  1995 EDU0101     ERROR   \n10 UNITED STATES 00000 EDU010196D   44715737  1996 EDU0101     ERROR   \n# ℹ 1,050 more rows"
  }
]